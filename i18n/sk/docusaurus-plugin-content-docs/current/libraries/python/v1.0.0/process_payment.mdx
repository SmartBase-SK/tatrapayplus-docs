import CodeBlock from '@theme/CodeBlock';

# Spracovanie platby

Po dokonƒçen√≠ oper√°ci√≠ v slu≈æbe TatraPayPlus bude pou≈æ√≠vateƒæ presmerovan√Ω na **URL adresu presmerovania** uveden√∫ pri inicializ√°cii platby.

## Parametre presmerovania

### Path parametre pre presmerovanie bez technickej chyby

| Path Parameter  | Typ    | Povinn√©          | Popis                                   |
| --------------- | ------ | -----------------| --------------------------------------- |
| `paymentId`     | string | Povinn√©          | ID platby                               |
| `paymentMethod` | string | Povinn√©          | K√≥d zvolenej platobnej met√≥dy           |

### Path parametre pre presmerovanie v pr√≠pade technickej chyby

| Path Parameter  | Typ    | Povinn√©   | Popis                                   |
| --------------- | ------ | ----------| --------------------------------------- |
| `paymentId`     | string | Povinn√©   | ID platby                               |
| `error`         | string | Povinn√©   | K√≥d chyby                               |
| `errorId`       | string | Povinn√©   | unik√°tne ID chyby                       |

### Pr√≠klad

√öspech ‚úîÔ∏è
```bash
https://theredirecturl.com/redirect?paymentId=e43f85a2-b21f-4ec2-b0a1-0e449d6972c7&paymentMethod=CARD_PAY
```

Chyba ‚ùåÔ∏è
```bash
https://theredirecturl.com/redirect?paymentId=e43f85a2-b21f-4ec2-b0a1-0e449d6972c7&error=FAILED&errorId=43ca30ec-2956-454c-9d1b-4bd2befee7c8
```

## Z√≠skanie stavu platby

Na z√°klade prijat√Ωch parametrov GET by ste mali z√≠ska≈• stav platby nasledovne:

import getPaymentStatus from '!!raw-loader!@site/code_samples/python/v1.0.0/get_payment_status.py';

<CodeBlock language="python">{getPaymentStatus}</CodeBlock>

:::info
- V **sandbox** re≈æime sa stav platby zmen√≠ z PENDING na cieƒæov√Ω stav po kr√°tkom oneskoren√≠ (zvyƒçajne 2‚Äì5 min√∫t).
- V **produkƒçnom** re≈æime je stav platby zvyƒçajne u≈æ aktualizovan√Ω na koneƒçn√Ω stav v ƒçase, keƒè je pou≈æ√≠vateƒæ presmerovan√Ω. V niektor√Ωch pr√≠padoch v≈°ak m√¥≈æe stav st√°le zosta≈• PENDING na kr√°tky ƒças kv√¥li spracovaniu.
:::

V√Ωsledok obsahuje atrib√∫t `simpleStatus`, ktor√Ω zjednodu≈°uje stav platby na jeden zo ≈°tyroch nasledovn√Ωch stavov:
- **AUTHORIZED**
- **CAPTURE**
- **REJECTED**
- **PENDING**

Hodnota `simpleStatus` sa urƒçuje podƒæa nasleduj√∫cej tabuƒæky. Ak ≈æiadna z podmienok nevyhovuje, predvolen√° hodnota je `PENDING`.

| Payment Method | CAPTURE                      | REJECTED   | AUTHORIZED |
|----------------|-----------------------------------------|----------------------|----------------------|
| QR_PAY         | ACCC                              | CANC, RJCT           |                      |
| BANK_TRANSFER  | ACSC, ACCC                              | CANC, RJCT           |                      |
| PAY_LATER      | LOAN_APPLICATION_FINISHED, LOAN_DISBURSED | CANCELED, EXPIRED    |                      |
| CARD_PAY       | OK, CB                                  | FAIL                 | PA                   |
| DIRECT_API     | OK, CB                                  | FAIL                 |                      |

Va≈°a implement√°cia by mala vykona≈• pr√≠slu≈°n√© akcie na z√°klade hodnoty `simple_status`.

Atrib√∫t `data` obsahuje v≈°etky inform√°cie na z√°klade ≈°trukt√∫ry op√≠sanej v [API pr√≠ruƒçke](/docs/api/get-payment-intent-status).

Odpoveƒè obsahuje aj ulo≈æen√© inform√°cie o karte (ak sa z√°kazn√≠k rozhodne ulo≈æi≈• √∫daje o svojej karte).
Viac podrobnost√≠ o tejto funkcii n√°jdete [üí≥ tu üí≥](/docs/libraries/python/v1.0.0/save_card).

## Periodick√° √∫loha

Niektor√© platby m√¥≈æu by≈• spracovan√© nesk√¥r.
Preto by ste mali pravidelne kontrolova≈• stav **‚Äûƒçakaj√∫cich‚Äú platieb**.
Odpor√∫ƒçame nastavi≈• pl√°novan√∫ √∫lohu, ktor√° z v√°≈°ho syst√©mu naƒç√≠ta v≈°etky ƒçakaj√∫ce platby.
Pomocou ulo≈æen√©ho `payment_id` s met√≥dou `get_payment_status` m√¥≈æete z√≠ska≈• aktu√°lny stav a vykona≈• pr√≠slu≈°n√© akcie vo va≈°om syst√©me.

Odpor√∫ƒçan√© intervaly z√≠skania stavov na z√°klade **veku objedn√°vok**:

| ƒåasov√Ω rozsah         | Frekvencia dopytu   |
|-----------------------|---------------------|
| 1. hodina             | Ka≈æd√Ωch 5 min√∫t     |
| 1 hodina - 24 hod√≠n   | Ka≈æd√∫ hodinu        |
| Po 24 hodin√°ch        | 5-kr√°t denne        |

<Button label="Prejs≈• na kompletn√∫ API pr√≠ruƒçku" link="/docs/api/get-payment-intent-status"/>